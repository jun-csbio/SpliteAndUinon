Java version, written by Yansong Bai.
